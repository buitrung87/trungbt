apiVersion: 1

templates:
  - orgId: 1
    name: telegram.custom.message
    template: |
      {{ define "telegram.custom.message" }}
      {{- if gt (len .Alerts.Firing) 0 }}
      {{- range .Alerts.Firing }}
      {{- $logLevel := or .Labels.log_level "LOG" }}
      {{- $container := or .Labels.container_name (or .Labels.container "unknown") }}

      {{- if eq $logLevel "panic" }}ğŸ’€{{ else if eq $logLevel "fatal" }}ğŸ”´{{ else }}âš ï¸{{ end }} <b>{{ .Labels.alertname }}</b>

      ğŸ“¦ <b>Container:</b> <code>{{ $container }}</code>
      ğŸ·ï¸ <b>Type:</b> <b>{{ $logLevel }}</b>
      â° <b>Time:</b> {{ .StartsAt | tz "Asia/Ho_Chi_Minh" | date "02/01/2006 15:04:05 MST" }}

      ğŸ“ <b>Message:</b>
      <pre>{{ or .Annotations.description .Annotations.summary }}</pre>

      ğŸ”— <a href="https://monitor.hocthongminh.ai/explore?orgId=1&left=%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22refId%22%3A%22A%22%2C%22expr%22%3A%22%7Bcontainer_name%3D%5C%22{{ $container }}%5C%22%7D%22%2C%22queryType%22%3A%22range%22%7D%5D%2C%22range%22%3A%7B%22from%22%3A%22now-1h%22%2C%22to%22%3A%22now%22%7D%7D">View Logs</a>
      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      {{- end }}
      {{- end }}

      {{- if gt (len .Alerts.Resolved) 0 }}
      âœ… <b>RESOLVED</b>
      {{- range .Alerts.Resolved }}
      â€¢ {{ or .Labels.container_name .Labels.container }} - {{ or .Labels.log_level "LOG" }}
      {{- end }}
      {{- end }}
      {{ end }}

  - orgId: 1
    name: telegram.metric.message
    template: |
      {{ define "telegram.metric.message" }}
      {{- if gt (len .Alerts.Firing) 0 }}
      {{- range .Alerts.Firing }}
      {{- $severity := or .Labels.severity "info" }}
      {{- $metric := or .Labels.metric "N/A" }}

      {{- if eq $severity "critical" }}ğŸ”¥{{ else if eq $severity "warning" }}âš ï¸{{ else }}â„¹ï¸{{ end }} <b>{{ .Labels.alertname }}</b>

      ğŸ’» <b>Host:</b> <code>{{ or .Labels.instance "unknown" }}</code>
      ğŸ“Š <b>Metric:</b> {{ $metric }}

      ğŸ“ <b>Details:</b>
      {{ or .Annotations.description .Annotations.summary }}

      ğŸ”— <a href="https://monitor.hocthongminh.ai/d/rYdddlPWk/node-exporter-full?var-node={{ or .Labels.instance "unknown" }}">View Dashboard</a>
      {{- end }}
      {{- end }}

      {{- if gt (len .Alerts.Resolved) 0 }}
      âœ… <b>RESOLVED</b>
      {{- range .Alerts.Resolved }}
      â€¢ {{ or .Labels.instance "unknown" }} - {{ .Labels.alertname }}
      {{- end }}
      {{- end }}
      {{ end }}