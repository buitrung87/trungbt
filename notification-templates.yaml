apiVersion: 1

templates:
  - name: telegram.custom.message
    template: |
      {{ define "telegram.custom.message" }}
      {{- if .Alerts }}
      {{- range .Alerts }}

      {{/* Emoji selector based on log_level */}}
      {{- $emoji := "âš ï¸" -}}
      {{- if eq (index .Labels "log_level") "panic" -}}
        {{- $emoji = "ğŸ’€" -}}
      {{- else if eq (index .Labels "log_level") "fatal" -}}
        {{- $emoji = "ğŸ”´" -}}
      {{- else if eq (index .Labels "log_level") "error" -}}
        {{- $emoji = "âš ï¸" -}}
      {{- end }}

      {{- if eq .Status "firing" }}
      <b>{{ $emoji }} ALERT: {{ index .Labels "alertname" | default "Docker Log Alert" }}</b>
      {{- else }}
      <b>âœ… RESOLVED: {{ index .Labels "alertname" | default "Docker Log Alert" }}</b>
      {{- end }}

      ğŸ“¦ <b>Container:</b>
      <code>{{ index .Labels "container" | default "unknown" }}</code>

      ğŸ·ï¸ <b>Type:</b>
      <b>{{ index .Labels "log_level" | default "log" | upper }}</b>

      ğŸ“ <b>Log Message:</b>
      <pre>
      {{- if .Annotations.description -}}
      {{ .Annotations.description
         | reReplaceAll "&" "&amp;"
         | reReplaceAll "<" "&lt;"
         | reReplaceAll ">" "&gt;"
      }}
      {{- else -}}
      No log content (test alert)
      {{- end -}}
      </pre>

      ğŸ”— <a href="https://monitor.hocthongminh.ai/explore">View on Monitor</a>

      {{- end }}
      {{- else }}

      <b>ğŸš¨ DOCKER LOG ALERT (TEST)</b>
      This is a test alert from Grafana.

      {{- end }}
      {{ end }}
